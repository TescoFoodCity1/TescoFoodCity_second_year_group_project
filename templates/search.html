<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tesco Food City</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; }

    /* Navbar */
    .navbar { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#f8f9fa; border-bottom:1px solid #ddd; position:relative; }
    .logo img { height:50px; }
    .nav-links { list-style:none; display:flex; gap:20px; margin:0; padding:0; }
    .nav-links li a { text-decoration:none; color:#333; font-weight:500; transition:color 0.3s; }
    .nav-links li a:hover { color:#155724; }

    /* Search bar */
    .search-bar { position:relative; display:flex; align-items:center; }
    #searchBox { padding:6px; border:1px solid #ccc; border-radius:4px; width:250px; }
    #searchBtn { margin-left:5px; cursor:pointer; border:none; background:none; font-size:18px; }
    .search-dropdown { position:absolute; top:38px; left:0; width:100%; background:white; border:1px solid #ccc; border-top:none; box-shadow:0 2px 8px rgba(0,0,0,0.15); display:none; z-index:1000; max-height:250px; overflow-y:auto; }
    .search-item { display:flex; align-items:center; padding:6px 10px; cursor:pointer; }
    .search-item img { width:35px; height:35px; object-fit:cover; border-radius:4px; margin-right:10px; }
    .search-item:hover { background-color:#f1f1f1; }
    .search-item .info { display:flex; flex-direction:column; }
    .search-item .info .name { font-size:13px; font-weight:600; }
    .search-item .info .price { font-size:12px; color:green; }

    .icons i { margin-left:15px; font-size:18px; cursor:pointer; color:#333; }
    .icons i:hover { color:#155724; }

    /* Welcome */
    #welcome-msg { text-align:center; margin:20px auto; background:#d4edda; border:1px solid #c3e6cb; padding:12px; border-radius:5px; width:fit-content; }
    #welcome-msg.guest { background:#f8d7da; border-color:#f5c6cb; color:#721c24; }

    /* Slider */
    .slider { position: relative; overflow: hidden; height: 200px; }
    .slide { display: none; text-align:center; font-size:1.8rem; padding:60px; background:#f1f1f1; animation:fadeSlide 1s ease-in-out; }
    .slide.active { display:block; }
    @keyframes fadeSlide { from {opacity:0; transform:translateX(50px);} to {opacity:1; transform:translateX(0);} }
    .slider button { position:absolute; top:50%; transform:translateY(-50%); background:none; border:none; font-size:30px; cursor:pointer; }
    .slider .prev { left:10px; } .slider .next { right:10px; }

    /* Categories */
    .categories { padding:20px; }
    .category-list { display:flex; gap:15px; flex-wrap:wrap; }
    .cat-item { cursor:pointer; transition: transform 0.4s, box-shadow 0.4s; text-align:center; }
    .cat-item:hover { transform: translateY(-10px) scale(1.05); box-shadow:0px 6px 15px rgba(0,0,0,0.2); }
    .cat-item img { width:120px; height:120px; object-fit:cover; border-radius:5px; }

    /* Products */
    .products { padding:20px; }
    .product-grid { display:flex; flex-wrap:wrap; gap:20px; }
    .product-card { border:1px solid #ddd; border-radius:8px; padding:10px; width:180px; text-align:center; background:#f9f9f9; transition: transform 0.3s, box-shadow 0.3s; }
    .product-card:hover { transform:scale(1.05); box-shadow:0 4px 12px rgba(0,0,0,0.2); }
    .product-card img { width:150px; height:150px; object-fit:cover; border-radius:5px; }
    .product-name { font-weight:bold; margin:10px 0 5px; }
    .product-price { color:green; }

    /* Ads carousel */
    .ads-carousel { position:relative; padding:20px; }
    .ads-slide { display:none; animation:fadeAd 1s ease-in-out; text-align:center; }
    .ads-slide.active { display:block; }
    @keyframes fadeAd { from {opacity:0.3; transform:scale(0.95);} to {opacity:1; transform:scale(1);} }
    .ads-prev, .ads-next { position:absolute; top:50%; transform:translateY(-50%); background:none; border:none; font-size:30px; cursor:pointer; }
    .ads-prev { left:10px; } .ads-next { right:10px; }
    .ads-dots { text-align:center; margin-top:10px; }
    .dot { display:inline-block; width:10px; height:10px; background:#ccc; border-radius:50%; margin:0 5px; cursor:pointer; }
    .dot.active { background:#155724; }

    /* Brands */
    .brands { padding:20px; }
    .brand-list { display:flex; gap:15px; flex-wrap:wrap; }
    .brand-item { text-align:center; }
    .brand-item img { width:100px; height:50px; object-fit:contain; }

    /* Footer */
    footer { background:#f1f1f1; padding:20px; display:flex; justify-content:space-around; flex-wrap:wrap; }
    footer h3 { margin-bottom:8px; }
    footer p { margin:3px 0; }
  </style>
</head>
<body>

 <!-- NAVBAR -->
<header>
  <nav class="navbar">
    <div class="logo">
      <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo">
    </div>
    <ul class="nav-links">
      <li><a href="{{ url_for('search_page') }}">Home</a></li>
      <li><a href="{{ url_for('about') }}">About</a></li>
      <li><a href="{{ url_for('delivery') }}">Delivery</a></li>
      <li><a href="{{ url_for('contact') }}">Contact</a></li>
    </ul>
    <div class="search-bar">
      <input type="text" id="searchBox" placeholder="Search for products...">
      <button id="searchBtn">üîç</button>
      <div id="searchDropdown" class="search-dropdown"></div>
    </div>
    <div class="icons">
      <i class="fa-solid fa-bell"></i>
      <i class="fa-solid fa-cart-shopping"></i>
<!-- USER ICON: DYNAMIC LOGIN/ACCOUNT -->
{% if session.get('user') %}
  <a href="{{ url_for('account') }}" title="Account" class="user-icon">
    <i class="fa-solid fa-user"></i> {{ session['user']['name'] }}
  </a>
{% else %}
  <a href="{{ url_for('manual_login') }}" title="Login" class="user-icon">
    <i class="fa-solid fa-user"></i> Account
  </a>
{% endif %}

    </div>
  </nav>
</header>

<style>
/* optional styling to make icon clickable without changing layout */
.icons a.user-icon {
  color: inherit;
  text-decoration: none;
  margin-left: 10px;
}
.icons a.user-icon:hover {
  color: #28a745; /* highlight on hover */
}
</style>

  <!-- Welcome Message -->
  {% if username %}
  <div id="welcome-msg">üéâ Welcome back TescoFoodCity, <strong>{{ username }}</strong>! Happy shopping üõí</div>
  {% else %}
  <div id="welcome-msg" class="guest">üëã Welcome guest! Please <a href="{{ url_for('login') }}">login</a> or <a href="{{ url_for('register') }}">register</a>.</div>
  {% endif %}

  <!-- Slider -->
  <section class="slider">
    <div class="slide active"><h2>Fresh Groceries Delivered Fast</h2></div>
    <div class="slide"><h2>Up to 50% OFF Daily Deals</h2></div>
    <div class="slide"><h2>Secure Payments & Easy Checkout</h2></div>
    <button class="prev">&#10094;</button>
    <button class="next">&#10095;</button>
  </section>

  <!-- Categories -->
  <section class="categories">
    <h2>Categories</h2>
    <div class="category-list">
      <div class="cat-item"><img src="{{ url_for('static', filename='images/categories/beverages.jpg') }}" alt="Beverages"><p>Beverages</p></div>
      <div class="cat-item"><img src="{{ url_for('static', filename='images/categories/bakery.jpg') }}" alt="Bakery"><p>Bakery</p></div>
      <div class="cat-item"><img src="{{ url_for('static', filename='images/categories/dailydeals.jpeg') }}" alt="Daily Deals"><p>Daily Deals</p></div>
      <div class="cat-item"><img src="{{ url_for('static', filename='images/categories/dairy.jpg') }}" alt="Dairy"><p>Dairy</p></div>
      <div class="cat-item"><img src="{{ url_for('static', filename='images/categories/frozen.jpeg') }}" alt="Frozen"><p>Frozen</p></div>
      <div class="cat-item"><img src="{{ url_for('static', filename='images/categories/grocery.jpg') }}" alt="Grocery"><p>Grocery</p></div>
    </div>
  </section>

  <!-- Products -->
<section class="products">
  <h2>Popular Products</h2>
  <div class="product-grid">

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product1.jpg') }}">
      <div class="product-name">Eva Cotton Feel</div>
      <div class="product-price">Rs.300.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product2.jpeg') }}">
      <div class="product-name">Coca Cola 1.5L</div>
      <div class="product-price">Rs.400.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product3.jpeg') }}">
      <div class="product-name">Carrot 500g</div>
      <div class="product-price">Rs.160.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product4.png') }}">
      <div class="product-name">Oreo Biscuits</div>
      <div class="product-price">Rs.250.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/Milk.png') }}">
      <div class="product-name">Milk 1L</div>
      <div class="product-price">Rs.200.00</div>
    </div>

    <!-- New Products -->
    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product5.jpg') }}">
      <div class="product-name">Sunlight Soap 120g</div>
      <div class="product-price">Rs.180.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product6.jpg') }}">
      <div class="product-name">Noodles Pack</div>
      <div class="product-price">Rs.90.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product7.jpg') }}">
      <div class="product-name">Kist Jam 500g</div>
      <div class="product-price">Rs.560.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product8.jpg') }}">
      <div class="product-name">Rice 5kg</div>
      <div class="product-price">Rs.2,200.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product9.jpg') }}">
      <div class="product-name">Anchor Butter 250g</div>
      <div class="product-price">Rs.1,050.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product10.jpg') }}">
      <div class="product-name">Sunquick Orange 1L</div>
      <div class="product-price">Rs.1,350.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product11.jpg') }}">
      <div class="product-name">Dhal 1kg</div>
      <div class="product-price">Rs.420.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product12.jpg') }}">
      <div class="product-name">Fresh Eggs (6 Pack)</div>
      <div class="product-price">Rs.360.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product13.jpg') }}">
      <div class="product-name">Lipton Tea 200g</div>
      <div class="product-price">Rs.980.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product14.jpg') }}">
      <div class="product-name">Shampoo 180ml</div>
      <div class="product-price">Rs.550.00</div>
    </div>

    <div class="product-card">
      <img src="{{ url_for('static', filename='images/product/product15.jpg') }}">
      <div class="product-name">Dettol Handwash</div>
      <div class="product-price">Rs.420.00</div>
    </div>

  </div>
</section>



  <!-- Ads Carousel -->
  <section class="ads-carousel">
    <div class="ads-slide active"><img src="{{ url_for('static', filename='images/B_ad/ad1.png') }}" alt="Ad 1"></div>
    <div class="ads-slide"><img src="{{ url_for('static', filename='images/B_ad/ad2.png') }}" alt="Ad 2"></div>
    <div class="ads-slide"><img src="{{ url_for('static', filename='images/B_ad/ad3.png') }}" alt="Ad 3"></div>
    <button class="ads-prev">&#10094;</button>
    <button class="ads-next">&#10095;</button>
    <div class="ads-dots">
      <span class="dot active" data-index="0"></span>
      <span class="dot" data-index="1"></span>
      <span class="dot" data-index="2"></span>
    </div>
  </section>

  <!-- Brands -->
  <section class="brands">
    <h2>Our Brands</h2>
    <div class="brand-list">
      <div class="brand-item"><img src="{{ url_for('static', filename='images/brand/brand1.png') }}" alt="Nestl√©"><p>Nestl√©</p></div>
      <div class="brand-item"><img src="{{ url_for('static', filename='images/brand/brand2.png') }}" alt="Unilever"><p>Unilever</p></div>
      <div class="brand-item"><img src="{{ url_for('static', filename='images/brand/brand3.png') }}" alt="Elephant House"><p>Elephant House</p></div>
      <div class="brand-item"><img src="{{ url_for('static', filename='images/brand/brand4.png') }}" alt="Coca-Cola"><p>Coca-Cola</p></div>
      <div class="brand-item"><img src="{{ url_for('static', filename='images/brand/brand5.png') }}" alt="Pepsi"><p>Pepsi</p></div>
      <div class="brand-item"><img src="{{ url_for('static', filename='images/brand/brand6.png') }}" alt="Maliban"><p>Maliban</p></div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div>
      <h3>Tesco Food City</h3>
      <p>Crafting exceptional shopping experiences for our valued customers.</p>
    </div>
    <div>
      <h3>Contact Us</h3>
      <p>üìç 380/F Leyland Junction, Panagoda Homagama</p>
      <p>üìû 0773659784</p>
      <p>üìß TescoFoodCity@gmail.com</p>
    </div>
    <div>
      <h3>Quick Links</h3>
      <p>About</p>
      <p>Privacy Policy</p>
      <p>Return Policy</p>
      <p>Shipping Info</p>
    </div>
  </footer>

  <script>
  // --- Main Slider ---
  let slideIndex = 0;
  const slides = document.querySelectorAll(".slider .slide");
  function showSlide(n){ slides.forEach((s,i)=>{ s.classList.remove("active"); if(i===n) s.classList.add("active"); }); }
  function nextSlide(){ slideIndex=(slideIndex+1)%slides.length; showSlide(slideIndex); }
  function prevSlideFn(){ slideIndex=(slideIndex-1+slides.length)%slides.length; showSlide(slideIndex); }
  document.querySelector(".slider .next").addEventListener("click",nextSlide);
  document.querySelector(".slider .prev").addEventListener("click",prevSlideFn);
  setInterval(nextSlide,4000);

  // --- Ads Carousel ---
  let adIndex = 0;
  const ads = document.querySelectorAll(".ads-carousel .ads-slide");
  const adsDots = document.querySelectorAll(".ads-dots .dot");
  function showAd(n){ ads.forEach((a,i)=>{ a.classList.remove("active"); adsDots[i].classList.remove("active"); if(i===n){ a.classList.add("active"); adsDots[i].classList.add("active"); } }); }
  function nextAd(){ adIndex=(adIndex+1)%ads.length; showAd(adIndex); }
  function prevAdFn(){ adIndex=(adIndex-1+ads.length)%ads.length; showAd(adIndex); }
  document.querySelector(".ads-next").addEventListener("click",nextAd);
  document.querySelector(".ads-prev").addEventListener("click",prevAdFn);
  adsDots.forEach(dot=>{ dot.addEventListener("click",()=>{ adIndex=parseInt(dot.dataset.index); showAd(adIndex); }); });
  setInterval(nextAd,5000);

  // --- Live Search ---
  $('#searchBox').on('input', function() {
    const query = $(this).val().trim();
    const dropdown = $('#searchDropdown');
    if(query.length<2){ dropdown.hide(); return; }
    $.ajax({
      url:'/search_products',
      method:'GET',
      data:{ q: query },
      success:function(res){
        dropdown.empty();
        if(!res || res.length===0){ dropdown.append('<div class="search-item" style="justify-content:center; color:#777;">No products found</div>').show(); return; }
        res.forEach(item=>{
      const el = $(`
  <div class="search-item" data-id="${item.id}">
    <img src="/static/images/product/${item.image_name}" alt="${item.name}">

    <div class="info">
      <span class="name">${item.name}</span>
      <span class="price">Rs.${item.price}</span>
    </div>
  </div>
`);

          el.on('click',()=>{ window.location.href='/product/'+item.id; });
          dropdown.append(el);
        });
        dropdown.show();
      },
      error:function(){ dropdown.empty().append('<div class="search-item" style="justify-content:center; color:#d9534f;">Error loading results</div>').show(); }
    });
  });

  $('#searchBtn').on('click', function(){
    const query = $('#searchBox').val().trim();
    if(query.length>1){
      $.ajax({ url:'/search_products', method:'GET', data:{ q:query }, success:function(res){
        if(res.length===1) window.location.href='/product/'+res[0].id;
        else if(res.length>1) $('#searchDropdown').show();
        else alert('No products found');
      }});
    }
  });

  $(document).on('click', function(e){
    if(!$(e.target).closest('.search-bar').length) $('#searchDropdown').hide();
  });
  </script>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
